<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="./reset.css" />
    <link rel="stylesheet" href="./index.css" />
    <title>Chan Bank</title>
  </head>
  <body>
    <div id="main-img-wrapper" style="margin-top: 300px">
      <img
        width="320"
        src="./assets/Lovepik_com-401339128-data-management-data-analysis-icon-free-vector-illustration-mate.png"
        alt="coding img"
      />
    </div>

    <div id="intro-main">
      <p>안녕하세요, 박찬건입니다.</p>
      <p>클론 코딩 중..</p>
      <p id="join-us-text">Join us!</p>
      <img id="down-arrow-icon" src="./assets/down-arrow.png" alt="down arrow" />
    </div>

    <ul id="list-item-wrapper">
      <li class="list-item">띠리로리리링</li>
      <li class="list-item">박찬건</li>
      <li class="list-item">클론코딩</li>
      <li class="list-item">CSS3</li>
      <li class="list-item">Nesting</li>
      <li class="list-item">Hello</li>
      <li class="list-item">띠리로리리링</li>
      <li class="list-item">박찬건</li>
      <li class="list-item">클론코딩</li>
      <li class="list-item">CSS3</li>
      <li class="list-item">Nesting</li>
      <li class="list-item">Hello</li>
      <li class="list-item">띠리로리리링</li>
      <li class="list-item">박찬건</li>
      <li class="list-item">클론코딩</li>
      <li class="list-item">CSS3</li>
      <li class="list-item">Nesting</li>
      <li class="list-item">Hello</li>
      <li class="list-item">띠리로리리링</li>
      <li class="list-item">박찬건</li>
      <li class="list-item">클론코딩</li>
      <li class="list-item">CSS3</li>
      <li class="list-item">Nesting</li>
      <li class="list-item">Hello</li>
      <li class="list-item">띠리로리리링</li>
      <li class="list-item">박찬건</li>
      <li class="list-item">클론코딩</li>
      <li class="list-item">CSS3</li>
      <li class="list-item">Nesting</li>
      <li class="list-item">Hello</li>
      <li class="list-item">띠리로리리링</li>
      <li class="list-item">박찬건</li>
      <li class="list-item">클론코딩</li>
      <li class="list-item">CSS3</li>
      <li class="list-item">Nesting</li>
      <li class="list-item">Hello</li>
    </ul>
    <div style="margin-top: 3000px"></div>

    <script>
      const animations = {
        listScroll: null
      }
      const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
          if (entry.target.id === "list-item-wrapper") listScrollAnimation(entry)
        })
      })

      function listScrollAnimation(entry) {
        console.log("list-item-wrapper")
        const rect = entry.boundingClientRect
        const top = rect.top + window.scrollY
        const bottom = rect.bottom + window.scrollY
        const listItems = document.querySelectorAll(".list-item")
        if(!animations.listScroll) {
          animations.listScroll = onScroll({ top, bottom }, listItems)
        }

        if (entry.isIntersecting) {
          console.log("call")
          window.addEventListener("scroll", animations.listScroll)
        } else {
          console.log("remove")
          window.removeEventListener("scroll", animations.listScroll)
        }
      }

      function onScroll(rect, listItems) {
        let ticking = false

        return () => {
          if (!ticking) {
            requestAnimationFrame(() => {
              applyAnimation(rect, listItems)
              ticking = false
            })

            ticking = true
          }
        }
      }

      function applyAnimation(rect, listItems) {
        const viewportHeight = window.innerHeight
        const centerY = window.scrollY + viewportHeight / 2 // 중앙 y 좌표
        console.log("centerY: ", centerY, rect.top, rect.bottom)

        if (centerY >= rect.top && centerY <= rect.bottom) {
          if (document.getElementById("on")) {
            document.getElementById("on").removeAttribute("id")
          }

          const division = (rect.bottom - rect.top) / listItems.length
          const target = Math.floor((centerY - rect.top) / division)
          console.log("target: ", target)

          if (target >= 0 && target < listItems.length) {
            listItems[target].id = "on"
          }
        }
      }

      const listWrapper = document.getElementById("list-item-wrapper")
      observer.observe(listWrapper)
    </script>
  </body>
</html>
